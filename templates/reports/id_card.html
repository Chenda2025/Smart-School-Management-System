<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID Card • {{ user.get_full_name }}</title>
    {% load static %}

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* BASE & PRINT STYLES (Keep these clean) */
        /* BASE & PRINT STYLES (Keep these clean) */
        @media print {
            /* *** FIX: FORCE BROWSER TO PRINT BACKGROUND COLORS *** */
            .header {
                -webkit-print-color-adjust: exact; /* Chrome, Safari */
                print-color-adjust: exact;         /* Firefox, Edge, Opera */
            }
            .id-card::before {
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
            }
            /* ****************************************************** */
            
            .no-print { display: none !important; }
            body { background: #fff !important; margin: 0 !important; }
            .id-card { box-shadow: none !important; border: 1px solid #ddd; } /* Add border for print boundary */
        }

        /* ... rest of your CSS styles ... */

        /* HEADER (Refined Gradient) */
        .header {
            /* Deeper, richer blue */
            background: linear-gradient(135deg, #1f4287 0%, #3073b6 100%);
            color: #fff;
            padding: 0.25in 0.3in 0.2in 0.3in; /* Adjust padding */
            text-align: center;
            position: relative;
        }

        body {
            background: #f4f7f9; /* Lighter background */
            padding: 2rem 0;
            font-family: 'Roboto', "Segoe UI", system-ui, sans-serif; /* Using Roboto or your preferred font */
        }

        /* ACTION BUTTONS */
        .actions {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        /* CARD CONTAINER */
        .id-card {
            width: 5.6in;
            height: 4.4in;
            margin: auto;
            background: #fff;
            border-radius: 16px; /* Slightly rounder corners */
            overflow: hidden;
            box-shadow: 0 16px 40px rgba(0,0,0,.15); /* Softer shadow */
            display: flex;
            flex-direction: column;
            border: 1px solid #e0e0e0; /* Subtle border for definition */
            position: relative; 
        }

        /* HEADER (Refined Gradient) */
        .header {
            /* Deeper, richer blue */
            background: linear-gradient(135deg, #1f4287 0%, #3073b6 100%);
            color: #fff;
            padding: 0.25in 0.3in 0.2in 0.3in; /* Adjust padding */
            text-align: center;
            position: relative;
        }

        .school-name {
            font-size: 1.25rem; /* Slightly larger */
            font-weight: 900;
            letter-spacing: 1.8px;
            text-transform: uppercase;
        }

        .school-tagline {
            font-size: 0.75rem;
            opacity: 0.95;
            margin-top: 2px;
            font-weight: 500;
        }
        
        /* Sublte design accent: A vertical blue line on the left side */
        .id-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 8px; /* Width of the accent strip */
            height: 100%;
            background-color: #3073b6; /* Match header color */
            z-index: 2; /* Ensure it is above the content but inside the card */
            border-radius: 16px 0 0 16px;
        }

        /* BODY */
        .content {
            flex: 1;
            display: grid;
            grid-template-columns: 2.2in auto; /* Photo column (Left) and Info column (Right) */
            gap: 0.3in;
            padding: 0.3in;
            padding-left: calc(0.3in + 8px); /* Account for the 8px accent strip */
            position: relative;
        }

        /* LEFT SIDE (Photo/Name block) */
        .left {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center align elements in the left column */
            justify-content: flex-start; /* Start content from the top */
        }

        .photo-name-block {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .photo,
        .initials {
            width: 1.5in;
            height: 1.8in;
            border-radius: 8px;
            border: 3px solid #3073b6;
            object-fit: cover;
            margin-bottom: 0.2in;
        }

        .initials {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3073b6, #1f4287);
            color: #fff;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .name-block {
            text-align: center;
            margin-top: -10px;
        }

        .name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            line-height: 1.2;
            margin-bottom: 2px;
        }

        .role {
            font-size: 0.9rem;
            font-weight: 700;
            color: #3073b6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* RIGHT SIDE (Info and QR Code) */
        .right {
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* PUSHES INFO TO TOP AND QR TO BOTTOM */
            padding-right: 0.1in;
            padding-top: 0.1in; /* Add a little top padding for alignment */
        }

        .info {
            font-size: 0.85rem;
            display: grid;
            grid-template-columns: 1fr 1.6fr;
            gap: 0.3rem 0.7rem;
            
        }

        .info span {
            color: #64748b;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info strong {
            color: #1e293b;
            font-weight: 700;
        }
        
        /* QR BOX - **NEW POSITION/ALIGNMENT** */
        .qr-box {
            text-align: right; /* Align QR code to the right edge of the card */
            margin-top: 0.3in; /* Space from the info grid if the card is small */
        }

        .qr-box img {
            width: 1.2in;
            height: 1.2in;
            background: white;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .qr-text {
            font-size: 0.6rem;
            color: #64748b;
            margin-top: 5px;
            font-weight: 500;
            text-transform: uppercase;
        }

        /* FOOTER */
        .footer {
            background: #f1f5f9;
            font-size: 0.65rem;
            text-align: center;
            padding: 0.15in;
            color: #64748b;
            font-weight: 500;
        }
    </style>
</head>

<body>

<div class="actions no-print">
    <a href="{% url 'report_list' %}" class="btn btn-outline-secondary btn-lg px-4 me-2">
        ← Back
    </a>
    <button onclick="window.print()" class="btn btn-success btn-lg px-5">
        Print ID Card
    </button>
</div>

<div class="id-card">

    <div class="header">
        <div class="school-name">ELITE INTERNATIONAL SCHOOL</div>
        <div class="school-tagline">Good Student </div>
    </div>

    <div class="content">

        <div class="left">

            <div class="photo-name-block">
                {% if user.photo %}
                    <img src="{{ user.photo.url }}" class="photo" alt="{{ user.get_full_name }}">
                {% else %}
                    <div class="initials">
                        {{ user.first_name.0|upper }}{{ user.last_name.0|upper }}
                    </div>
                {% endif %}

                <div class="name-block">
                    <div class="name">{{ user.get_full_name }}</div>
                    <div class="role">{{ user.get_role_display }}</div>
                </div>
            </div>

            </div>

        <div class="right">
    <div class="info">
        <span>ID No.</span>
        <strong>
            {% if user.role == 'student' %}
                {{ user.student_profile.id|default:user.id }}
            {% elif user.role == 'teacher' %}
                {{ user.teacher_profile.employee_id|default:user.id }}
            {% endif %}
        </strong>

        <span>Role-Num</span>
        <strong>
            {% if user.role == 'student' %}
                {{ user.student_profile.roll_number|default:"—" }}
            {% elif user.role == 'teacher' %}
                {{ user.teacher_profile.employee_id|default:"—" }}
            {% endif %}
        </strong>

        <span>Grade</span>
            <strong>
                {% if user.role == 'student' %}
                    {{ user.student_profile.classroom.name|default:"—" }}
                {% elif user.role == 'teacher' %}
                    Teaching Staff
                {% endif %}
            </strong>
        <span>Ex-Date</span>
        <strong>{{ user.date_joined|date:"d M Y" }}</strong>

        <span>Valid Till</span>
        <strong style="color: #c0402b;">31 Dec 2026</strong>
    </div>

    <div class="qr-box">
        <img src="data:image/png;base64,{{ qr_base64 }}" alt="QR Code">
        <div class="qr-text">Scan to verify ID</div>
    </div>
</div>

    </div>

    <div class="footer">
        Property of Elite International School • If found, please return to school administration.
    </div>

</div>

</body>
</html>